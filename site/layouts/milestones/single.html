{{ define "main" }}
<div class="container py-12">
  <div class="row">
    <div class="col-12 col-lg-8 offset-lg-2">
      <!-- Breadcrumb -->
      <nav class="mb-6 text-sm">
        <a href="/milestones/" class="text-gray-500 hover:text-emerald-600 text-decoration-none">Milestones</a>
        <span class="text-gray-400 mx-2">/</span>
        <span class="text-gray-700">{{ .Title }}</span>
      </nav>

      <article class="bg-white rounded-xl shadow-sm p-8">
        <!-- Header -->
        <div class="mb-8">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <span class="badge bg-emerald-100 text-emerald-800 px-3 py-2 rounded-full">{{ .Params.testType | default "Stress Test" }}</span>
            <span class="text-gray-500">{{ .Date.Format "January 2, 2006" }}</span>
          </div>
          <h1 class="text-3xl font-bold text-gray-900 mb-4">{{ .Title }}</h1>
          {{ if .Description }}
          <p class="text-xl text-gray-600">{{ .Description }}</p>
          {{ end }}
        </div>

        <!-- Key Metrics -->
        {{ with .Params.metrics }}
        <div class="row mb-8">
          {{ range . }}
          <div class="col-6 col-md-3 mb-4">
            <div class="bg-gray-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-emerald-600">{{ .value }}</div>
              <div class="text-sm text-gray-600">{{ .label }}</div>
            </div>
          </div>
          {{ end }}
        </div>
        {{ end }}

        <!-- Throughput Chart -->
        {{ with .Params.chartData }}
        <div class="mb-8">
          <h2 class="text-xl font-bold text-gray-900 mb-4">Throughput Over Time</h2>
          <div style="height: 350px;">
            <canvas id="throughputChart"></canvas>
          </div>
        </div>
        {{ end }}

        <!-- Content -->
        <div class="prose prose-lg max-w-none mb-8">
          {{ .Content }}
        </div>

        <!-- Test Configuration -->
        {{ with .Params.config }}
        <div class="bg-gray-50 rounded-lg p-6 mb-8">
          <h3 class="font-bold text-gray-900 mb-4">Test Configuration</h3>
          <div class="row">
            {{ range $key, $value := . }}
            <div class="col-6 col-md-4 mb-3">
              <div class="text-sm text-gray-500">{{ $key }}</div>
              <div class="font-medium text-gray-900">{{ $value }}</div>
            </div>
            {{ end }}
          </div>
        </div>
        {{ end }}

        <!-- Navigation -->
        <div class="border-t border-gray-200 pt-8">
          <div class="d-flex justify-content-between">
            {{ with .PrevInSection }}
            <a href="{{ .Permalink }}" class="text-gray-600 hover:text-emerald-600 text-decoration-none d-flex align-items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
              {{ .Title }}
            </a>
            {{ else }}
            <div></div>
            {{ end }}
            {{ with .NextInSection }}
            <a href="{{ .Permalink }}" class="text-gray-600 hover:text-emerald-600 text-decoration-none d-flex align-items-center gap-2">
              {{ .Title }}
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </a>
            {{ end }}
          </div>
        </div>
      </article>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ with .Params.chartData }}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('throughputChart').getContext('2d');

  const chartData = {{ . | jsonify }};

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: chartData.labels,
      datasets: [{
        label: 'Throughput (voters/sec)',
        data: chartData.values,
        borderColor: '#10b981',
        backgroundColor: 'rgba(16, 185, 129, 0.1)',
        fill: true,
        tension: 0.3,
        pointRadius: 2,
        pointHoverRadius: 5
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            title: function(context) {
              return context[0].label + ' voters';
            },
            label: function(context) {
              return context.parsed.y + ' voters/sec';
            }
          }
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Voters Processed'
          }
        },
        y: {
          title: {
            display: true,
            text: 'Throughput (voters/sec)'
          },
          min: 0
        }
      }
    }
  });
});
</script>
{{ end }}

<style>
  .prose h2 { font-size: 1.5rem; font-weight: 700; color: #111827; margin-top: 2.5rem; margin-bottom: 1rem; }
  .prose h3 { font-size: 1.25rem; font-weight: 700; color: #111827; margin-top: 2rem; margin-bottom: 0.75rem; }
  .prose p { color: #374151; margin-bottom: 1rem; line-height: 1.75; }
  .prose ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; color: #374151; }
  .prose ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 1rem; color: #374151; }
  .prose li { margin-bottom: 0.5rem; }
  .prose code { background-color: #f3f4f6; color: #1f2937; padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-size: 0.875rem; }
  .prose pre { background-color: #111827; color: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 1.5rem; }
  .prose pre code { background-color: transparent; color: #f3f4f6; padding: 0; }
  .prose strong { font-weight: 600; }
</style>
{{ end }}
